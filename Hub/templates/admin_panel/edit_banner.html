SS{% extends 'admin_panel/base_admin.html' %}
{% load static %}

{% block title %}Edit Banner - Admin Panel{% endblock %}

{% block content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <h4 class="fw-bold py-3 mb-4">
        <span class="text-muted fw-light">Content / Banners /</span> Edit Banner
    </h4>

    <!-- Display messages -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="row">
            <!-- Left Column -->
            <div class="col-xl-8">
                <!-- Basic Information -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">📋 Basic Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label" for="title">Banner Title *</label>
                            <input type="text" class="form-control" id="title" name="title" 
                                   value="{{ banner.title }}" required />
                        </div>

                        <div class="mb-3">
                            <label class="form-label" for="subtitle">Subtitle</label>
                            <input type="text" class="form-control" id="subtitle" name="subtitle" 
                                   value="{{ banner.subtitle }}" />
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label" for="badge_text">Badge Text</label>
                                <input type="text" class="form-control" id="badge_text" name="badge_text" 
                                       value="{{ banner.badge_text }}" />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label" for="banner_type">Banner Type *</label>
                                <select class="form-select" id="banner_type" name="banner_type" required>
                                    <option value="LARGE" {% if banner.banner_type == 'LARGE' %}selected{% endif %}>Large Banner</option>
                                    <option value="MEDIUM" {% if banner.banner_type == 'MEDIUM' %}selected{% endif %}>Medium Banner</option>
                                    <option value="SMALL" {% if banner.banner_type == 'SMALL' %}selected{% endif %}>Small Banner</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label" for="page_type">Show Banner On *</label>
                            <select class="form-select" id="page_type" name="page_type" required>
                                <option value="HOME" {% if banner.page_type == 'HOME' %}selected{% endif %}>Home Page Only</option>
                                <option value="SHOP" {% if banner.page_type == 'SHOP' %}selected{% endif %}>Shop Page Only</option>
                                <option value="BOTH" {% if banner.page_type == 'BOTH' %}selected{% endif %}>Both Home & Shop Pages</option>
                            </select>
                            <small class="text-muted">Choose where this banner should appear</small>
                        </div>
                    </div>
                </div>

                <!-- Link & Button -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">🔗 Link & Button</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label" for="link_url">Link URL</label>
                            <input type="text" class="form-control" id="link_url" name="link_url" 
                                   value="{{ banner.link_url }}" />
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label" for="button_text">Button Text</label>
                                <input type="text" class="form-control" id="button_text" name="button_text" 
                                       value="{{ banner.button_text }}" />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label" for="button_style">Button Style</label>
                                <select class="form-select" id="button_style" name="button_style">
                                    <option value="none" {% if banner.button_style == 'none' %}selected{% endif %}>No Button</option>
                                    <option value="st-btn" {% if banner.button_style == 'st-btn' %}selected{% endif %}>Yellow Button</option>
                                    <option value="st-btn-3 b-radius" {% if banner.button_style == 'st-btn-3 b-radius' %}selected{% endif %}>White Button</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Image -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">🖼️ Banner Image</h5>
                    </div>
                    <div class="card-body">
                        {% if banner.image %}
                        <div class="mb-3">
                            <label class="form-label">Current Image:</label>
                            <div>
                                <img src="{{ banner.image.url }}" alt="{{ banner.title }}" 
                                     style="max-width: 100%; height: auto; border-radius: 8px; border: 1px solid #ddd;" />
                            </div>
                        </div>
                        {% endif %}

                        <div class="mb-3">
                            <label class="form-label" for="image">Change Image</label>
                            <input type="file" class="form-control" id="image" name="image" 
                                   accept="image/*" onchange="previewImage(event)" />
                            <small class="text-muted">Leave empty to keep current image</small>
                        </div>

                        <div id="image-preview" style="display: none;">
                            <label class="form-label">New Preview:</label>
                            <div>
                                <img id="preview-img" src="" style="max-width: 100%; height: auto; border-radius: 8px; border: 1px solid #ddd;" />
                            </div>
                        </div>

                        <div class="mb-3 mt-3">
                            <label class="form-label" for="background_color">Background Color Overlay</label>
                            <input type="text" class="form-control" id="background_color" name="background_color" 
                                   value="{{ banner.background_color }}" placeholder="e.g., rgba(255,0,0,0.1)" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-xl-4">
                <!-- Settings -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">⚙️ Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label" for="order">Display Order</label>
                            <input type="number" class="form-control" id="order" name="order" 
                                   value="{{ banner.order }}" min="0" />
                        </div>

                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="is_active" name="is_active" 
                                   {% if banner.is_active %}checked{% endif %} />
                            <label class="form-check-label" for="is_active">
                                Active (Show on website)
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="card">
                    <div class="card-body">
                        <button type="submit" class="btn btn-primary w-100 mb-2">
                            <i class="bx bx-check me-1"></i> Update Banner
                        </button>
                        <a href="{% url 'admin_banners' %}" class="btn btn-outline-secondary w-100">
                            <i class="bx bx-x me-1"></i> Cancel
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
function previewImage(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('preview-img').src = e.target.result;
            document.getElementById('image-preview').style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
}
</script>
{% endblock %}
