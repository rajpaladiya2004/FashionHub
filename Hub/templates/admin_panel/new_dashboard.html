{% extends 'admin_panel/base_admin.html' %}
{% load static %}

{% block title %}Advanced Analytics Dashboard - FashioHub Admin{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'admin/assets/vendor/libs/apex-charts/apex-charts.css' %}" />
<style>
    :root {
        --primary: #696cff;
        --success: #71dd5a;
        --danger: #ff3e1d;
        --warning: #ffb64d;
        --info: #03c3ec;
        --dark: #233446;
    }
    
    body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }
    
    .kpi-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        border-left: 4px solid var(--primary);
    }
    
    .kpi-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }
    
    .kpi-card.success { border-left-color: var(--success); }
    .kpi-card.danger { border-left-color: var(--danger); }
    .kpi-card.warning { border-left-color: var(--warning); }
    .kpi-card.info { border-left-color: var(--info); }
    
    .kpi-value {
        font-size: 28px;
        font-weight: 700;
        color: var(--dark);
        margin: 10px 0;
    }
    
    .kpi-label {
        font-size: 13px;
        color: #6c757d;
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.5px;
    }
    
    .kpi-delta {
        font-size: 12px;
        margin-top: 8px;
        padding: 4px 8px;
        border-radius: 4px;
        display: inline-block;
        font-weight: 600;
    }
    
    .delta-positive {
        background: rgba(113, 221, 90, 0.1);
        color: var(--success);
    }
    
    .delta-negative {
        background: rgba(255, 62, 29, 0.1);
        color: var(--danger);
    }
    
    .chart-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .chart-card h5 {
        color: var(--dark);
        font-weight: 700;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }
    
    .chart-container {
        position: relative;
        height: 300px;
    }
    
    .chart-container-lg {
        position: relative;
        height: 400px;
    }
    
    .stat-box {
        text-align: center;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 10px;
    }
    
    .stat-box .stat-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary);
    }
    
    .stat-box .stat-label {
        font-size: 12px;
        color: #6c757d;
        margin-top: 5px;
        text-transform: uppercase;
    }
    
    .progress-ring {
        transform: rotate(-90deg);
    }
    
    .progress-ring-circle {
        transition: stroke-dashoffset 0.35s;
        transform-origin: 50% 50%;
    }
    
    .badge-lg {
        font-size: 13px;
        padding: 8px 12px;
    }
    
    .list-item {
        padding: 12px 0;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .list-item:last-child {
        border-bottom: none;
    }
    
    .product-name {
        font-weight: 600;
        color: var(--dark);
    }
    
    .product-value {
        color: var(--primary);
        font-weight: 700;
    }
    
    .section-title {
        color: var(--dark);
        font-size: 20px;
        font-weight: 700;
        margin-top: 30px;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid var(--primary);
    }
    
    .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
    .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
    
    @media (max-width: 1024px) {
        .grid-4, .grid-3 { grid-template-columns: repeat(2, 1fr); }
    }
    
    @media (max-width: 768px) {
        .grid-4, .grid-3, .grid-2 { grid-template-columns: 1fr; }
    }
    
    .icon-box {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }
    
    .icon-primary { background: rgba(105, 108, 255, 0.1); color: var(--primary); }
    .icon-success { background: rgba(113, 221, 90, 0.1); color: var(--success); }
    .icon-danger { background: rgba(255, 62, 29, 0.1); color: var(--danger); }
    .icon-warning { background: rgba(255, 182, 77, 0.1); color: var(--warning); }
    .icon-info { background: rgba(3, 195, 236, 0.1); color: var(--info); }
</style>
{% endblock %}

{% block content %}
<div class="container-xxl flex-grow-1 container-p-y">
    
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="mb-0" style="font-size: 28px; font-weight: 700; color: var(--dark);">
            <i class="bx bx-chart-line" style="font-size: 30px; color: var(--primary);"></i> Advanced Analytics Dashboard
        </h4>
        <div>
            <span class="badge bg-primary me-2"><i class="bx bx-calendar"></i> Last Updated: Now</span>
            <a href="{% url 'admin_dashboard' %}" class="btn btn-outline-secondary btn-sm">
                <i class="bx bx-arrow-back"></i> Classic Dashboard
            </a>
        </div>
    </div>

    <!-- ===== ROW 1: ALL-TIME KPIs ===== -->
    <div class="section-title">üí∞ All-Time Key Metrics</div>
    <div class="grid-4">
        <div class="kpi-card">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="kpi-label">Total Revenue</div>
                    <div class="kpi-value">‚Çπ{{ total_revenue_all|floatformat:0 }}</div>
                </div>
                <div class="icon-box icon-primary"><i class="bx bx-trending-up"></i></div>
            </div>
        </div>

        <div class="kpi-card success">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="kpi-label">Total Profit</div>
                    <div class="kpi-value">‚Çπ{{ total_profit_all|floatformat:0 }}</div>
                </div>
                <div class="icon-box icon-success"><i class="bx bx-money"></i></div>
            </div>
        </div>

        <div class="kpi-card info">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="kpi-label">Total Sales</div>
                    <div class="kpi-value">{{ total_sales_count }}</div>
                </div>
                <div class="icon-box icon-info"><i class="bx bx-shopping-bag"></i></div>
            </div>
        </div>

        <div class="kpi-card warning">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="kpi-label">Total Orders</div>
                    <div class="kpi-value">{{ total_orders_count }}</div>
                </div>
                <div class="icon-box icon-warning"><i class="bx bx-list-check"></i></div>
            </div>
        </div>
    </div>

    <!-- ===== ORDER STATUS SUMMARY ===== -->
    <div class="grid-2 mt-4">
        <div class="kpi-card success">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="kpi-label">Delivered Orders</div>
                    <div class="kpi-value">{{ delivered_count }}</div>
                </div>
                <div class="icon-box icon-success"><i class="bx bx-check-circle"></i></div>
            </div>
        </div>

        <div class="kpi-card danger">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="kpi-label">Pending Orders</div>
                    <div class="kpi-value">{{ pending_count }}</div>
                </div>
                <div class="icon-box icon-danger"><i class="bx bx-time-five"></i></div>
            </div>
        </div>
    </div>

    <!-- ===== ROW 2: TODAY vs YESTERDAY ===== -->
    <div class="section-title">üìÖ Daily Snapshot (Today vs Yesterday)</div>
    <div class="grid-3">
        <div class="chart-card">
            <h6 class="kpi-label">Today Revenue</h6>
            <h3 class="mt-2">‚Çπ{{ today_revenue|floatformat:0 }}</h3>
            <small class="text-muted">vs Yesterday: ‚Çπ{{ yesterday_revenue|floatformat:0 }}</small>
            <div class="kpi-delta {% if revenue_delta >= 0 %}delta-positive{% else %}delta-negative{% endif %}">
                <i class="bx {% if revenue_delta >= 0 %}bx-up-arrow-alt{% else %}bx-down-arrow-alt{% endif %}"></i>
                {{ revenue_delta|floatformat:1 }}%
            </div>
        </div>

        <div class="chart-card">
            <h6 class="kpi-label">Today Orders</h6>
            <h3 class="mt-2">{{ today_orders }}</h3>
            <small class="text-muted">vs Yesterday: {{ yesterday_orders }}</small>
            <div class="kpi-delta {% if orders_delta >= 0 %}delta-positive{% else %}delta-negative{% endif %}">
                <i class="bx {% if orders_delta >= 0 %}bx-up-arrow-alt{% else %}bx-down-arrow-alt{% endif %}"></i>
                {{ orders_delta|floatformat:1 }}%
            </div>
        </div>

        <div class="chart-card">
            <h6 class="kpi-label">Today Profit</h6>
            <h3 class="mt-2">‚Çπ{{ today_profit|floatformat:0 }}</h3>
            <small class="text-muted">vs Yesterday: ‚Çπ{{ yesterday_profit|floatformat:0 }}</small>
            <div class="kpi-delta {% if profit_delta >= 0 %}delta-positive{% else %}delta-negative{% endif %}">
                <i class="bx {% if profit_delta >= 0 %}bx-up-arrow-alt{% else %}bx-down-arrow-alt{% endif %}"></i>
                {{ profit_delta|floatformat:1 }}%
            </div>
        </div>
    </div>

    <!-- ===== ROW 3: WEEKLY CHARTS ===== -->
    <div class="section-title">üìä Weekly Charts (Last 7 Days)</div>
    <div class="grid-2">
        <div class="chart-card">
            <h5><i class="bx bx-bar-chart-alt-2" style="color: var(--primary);"></i> Daily Revenue Trend</h5>
            <div class="chart-container">
                <canvas id="dailyRevenueChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h5><i class="bx bx-bar-chart" style="color: var(--success);"></i> Daily Orders Trend</h5>
            <div class="chart-container">
                <canvas id="dailyOrdersChart"></canvas>
            </div>
        </div>
    </div>

    <!-- ===== ROW 4: MONTHLY SUMMARY ===== -->
    <div class="section-title">üéØ Monthly Summary (Current Month)</div>
    <div class="grid-4">
        <div class="kpi-card">
            <div class="kpi-label">Monthly Revenue</div>
            <div class="kpi-value">‚Çπ{{ monthly_revenue|floatformat:0 }}</div>
            <div class="kpi-delta delta-positive">
                <i class="bx bx-up-arrow-alt"></i> MoM: {{ mom_revenue_percent|floatformat:1 }}%
            </div>
        </div>

        <div class="kpi-card success">
            <div class="kpi-label">Monthly Orders</div>
            <div class="kpi-value">{{ monthly_orders }}</div>
            <div class="kpi-delta delta-positive">
                <i class="bx bx-up-arrow-alt"></i> MoM: {{ mom_orders_percent|floatformat:1 }}%
            </div>
        </div>

        <div class="kpi-card info">
            <div class="kpi-label">Monthly Profit</div>
            <div class="kpi-value">‚Çπ{{ monthly_profit|floatformat:0 }}</div>
        </div>

        <div class="kpi-card warning">
            <div class="kpi-label">Avg Order Value</div>
            <div class="kpi-value">‚Çπ{{ aov_30d|floatformat:0 }}</div>
        </div>
    </div>

    <!-- ===== ROW 5: 6 MONTHS TREND ===== -->
    <div class="section-title">üìà Last 6 Months Trend</div>
    <div class="chart-card">
        <h5><i class="bx bx-line-chart" style="color: var(--primary);"></i> Revenue, Orders & Profit Comparison</h5>
        <div class="chart-container-lg">
            <canvas id="sixMonthsChart"></canvas>
        </div>
    </div>

    <!-- ===== YESTERDAY FOCUS ===== -->
    <div class="section-title">üîç Yesterday Focus & Comparison</div>
    <div class="grid-2">
        <div class="chart-card">
            <h5><i class="bx bx-calendar-alt"></i> Yesterday Orders Status</h5>
            <div class="stat-box">
                <div class="stat-value">{{ yesterday_delivered }}</div>
                <div class="stat-label">Delivered</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">{{ yesterday_pending }}</div>
                <div class="stat-label">Pending</div>
            </div>
        </div>

        <div class="chart-card">
            <h5><i class="bx bx-git-compare"></i> Same Day Last Week</h5>
            <div class="stat-box">
                <div class="stat-value">‚Çπ{{ same_day_last_week_rev|floatformat:0 }}</div>
                <div class="stat-label">Revenue</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">{{ same_day_last_week_ord }}</div>
                <div class="stat-label">Orders</div>
            </div>
        </div>
    </div>

    <!-- ===== WEEKLY BREAKDOWN ===== -->
    <div class="section-title">üìã Weekly Breakdown (Last 7 Days)</div>
    <div class="grid-3">
        <div class="chart-card">
            <h6 class="kpi-label">Delivery Status</h6>
            <div class="d-flex justify-content-around mt-3">
                <div class="text-center">
                    <div class="stat-value" style="color: var(--success);">{{ delivered_percent|floatformat:1 }}%</div>
                    <small class="text-muted">Delivered</small>
                </div>
                <div class="text-center">
                    <div class="stat-value" style="color: var(--warning);">{{ pending_percent|floatformat:1 }}%</div>
                    <small class="text-muted">Pending</small>
                </div>
            </div>
        </div>

        <div class="chart-card">
            <h6 class="kpi-label">Avg Order Value</h6>
            <h3 class="mt-3">‚Çπ{{ avg_order_value_7d|floatformat:0 }}</h3>
            <small class="text-muted">Last 7 days</small>
        </div>

        <div class="chart-card">
            <h6 class="kpi-label">Weekly Totals</h6>
            <div class="stat-box">
                <div class="stat-value">‚Çπ{{ weekly_revenue|floatformat:0 }}</div>
                <div class="stat-label">Revenue</div>
            </div>
            <div class="stat-box mt-2">
                <div class="stat-value">{{ weekly_orders }}</div>
                <div class="stat-label">Orders</div>
            </div>
        </div>
    </div>

    <!-- ===== REVENUE INTELLIGENCE ===== -->
    <div class="section-title">üí° Revenue Intelligence (Last 30 Days)</div>
    <div class="grid-4">
        <div class="chart-card">
            <div class="kpi-label">Gross Revenue</div>
            <div class="kpi-value">‚Çπ{{ gross_revenue_30d|floatformat:0 }}</div>
        </div>

        <div class="chart-card success">
            <div class="kpi-label">Net Revenue</div>
            <div class="kpi-value">‚Çπ{{ net_revenue_30d|floatformat:0 }}</div>
        </div>

        <div class="chart-card warning">
            <div class="kpi-label">Estimated Refunds</div>
            <div class="kpi-value">‚Çπ{{ refunds_30d|floatformat:0 }}</div>
        </div>

        <div class="chart-card info">
            <div class="kpi-label">Avg Order Value</div>
            <div class="kpi-value">‚Çπ{{ aov_30d|floatformat:0 }}</div>
        </div>
    </div>

    <!-- ===== ORDER FUNNEL ===== -->
    <div class="section-title">üîó Order Funnel Analytics</div>
    <div class="grid-2">
        <div class="chart-card">
            <h5><i class="bx bx-funnel"></i> Conversion Funnel</h5>
            <div class="stat-box mt-3">
                <div class="stat-label">Cart ‚Üí Checkout</div>
                <div class="stat-value">{{ cart_to_checkout|floatformat:1 }}%</div>
            </div>
            <div class="stat-box mt-2">
                <div class="stat-label">Checkout ‚Üí Paid</div>
                <div class="stat-value">{{ checkout_to_paid|floatformat:1 }}%</div>
            </div>
            <div class="stat-box mt-2">
                <div class="stat-label">Payment Success Rate</div>
                <div class="stat-value" style="color: var(--success);">{{ payment_success_rate|floatformat:1 }}%</div>
            </div>
        </div>

        <div class="chart-card">
            <h5><i class="bx bx-pie-chart-alt"></i> Customer Type Distribution (30d)</h5>
            <div class="stat-box mt-3">
                <div class="stat-label">New Customers</div>
                <div class="stat-value">{{ new_customers_30d }}</div>
            </div>
            <div class="stat-box mt-2">
                <div class="stat-label">Returning Customers</div>
                <div class="stat-value">{{ returning_customers }}</div>
            </div>
            <div class="stat-box mt-2">
                <div class="stat-label">New vs Total (%)</div>
                <div class="stat-value" style="color: var(--info);">{{ new_vs_returning|floatformat:1 }}%</div>
            </div>
        </div>
    </div>

    <!-- ===== PRODUCT PERFORMANCE ===== -->
    <div class="section-title">‚≠ê Product Performance</div>
    <div class="grid-2">
        <div class="chart-card">
            <h5><i class="bx bx-trending-up"></i> Top 10 Products by Revenue</h5>
            <div style="max-height: 400px; overflow-y: auto;">
                {% for product in top_products_revenue %}
                <div class="list-item">
                    <span class="product-name">{{ product.product_name|truncatewords:3 }}</span>
                    <span class="product-value">‚Çπ{{ product.total_revenue|floatformat:0 }}</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="chart-card">
            <h5><i class="bx bx-shopping-bag"></i> Top 10 Products by Quantity</h5>
            <div style="max-height: 400px; overflow-y: auto;">
                {% for product in top_products_qty %}
                <div class="list-item">
                    <span class="product-name">{{ product.product_name|truncatewords:3 }}</span>
                    <span class="product-value">{{ product.total_qty }} units</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- ===== INVENTORY ALERTS ===== -->
    <div class="section-title">‚ö†Ô∏è Inventory & Operational Health</div>
    <div class="grid-3">
        <div class="chart-card danger">
            <h5><i class="bx bx-low-vision"></i> Low Stock Products</h5>
            <div style="max-height: 300px; overflow-y: auto;">
                {% for product in low_stock %}
                <div class="list-item">
                    <span>{{ product.name|truncatewords:2 }}</span>
                    <span class="badge bg-warning">{{ product.stock }}</span>
                </div>
                {% empty %}
                <p class="text-muted">No low stock products</p>
                {% endfor %}
            </div>
        </div>

        <div class="chart-card warning">
            <h6 class="kpi-label">Payment Health</h6>
            <div class="stat-box mt-3">
                <div class="stat-value" style="color: var(--success);">{{ payment_success_rate|floatformat:1 }}%</div>
                <div class="stat-label">Success Rate</div>
            </div>
            <div class="stat-box mt-2">
                <div class="stat-value" style="color: var(--danger);">{{ failed_payments }}</div>
                <div class="stat-label">Failed Payments</div>
            </div>
        </div>

        <div class="chart-card danger">
            <h6 class="kpi-label">Stock Status</h6>
            <div class="stat-box mt-3">
                <div class="stat-value" style="color: var(--danger);">{{ out_of_stock }}</div>
                <div class="stat-label">Out of Stock</div>
            </div>
        </div>
    </div>

    <!-- ===== REVIEWS & ENGAGEMENT ===== -->
    <div class="section-title">üí¨ Reviews & Customer Engagement</div>
    <div class="grid-3">
        <div class="chart-card">
            <h6 class="kpi-label">Average Rating</h6>
            <h3 class="mt-3">{{ avg_rating|floatformat:1 }}<small style="font-size: 16px;">/5</small></h3>
            <div class="mt-3">
                {% for i in "01234" %}
                    {% if forloop.counter <= avg_rating %}
                    <i class="bx bxs-star" style="color: var(--warning);"></i>
                    {% else %}
                    <i class="bx bx-star" style="color: #ddd;"></i>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <div class="chart-card">
            <h6 class="kpi-label">Review Approval Rate</h6>
            <h3 class="mt-3">{{ approval_rate|floatformat:1 }}<small style="font-size: 16px;">%</small></h3>
            <small class="text-muted">Reviews approved & visible</small>
        </div>

        <div class="chart-card">
            <h6 class="kpi-label">Recent Questions</h6>
            <div class="stat-value">{{ recent_questions|length }}</div>
            <small class="text-muted">Pending responses</small>
            {% if recent_questions %}
            <div class="mt-3" style="max-height: 150px; overflow-y: auto;">
                {% for q in recent_questions %}
                <p style="font-size: 12px; margin: 5px 0; color: #666;">
                    <strong>{{ q.user.username }}:</strong> {{ q.question|truncatewords:5 }}...
                </p>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Footer -->
    <div style="text-align: center; margin-top: 40px; padding: 20px; color: #999;">
        <p>Last updated: <strong id="lastUpdate"></strong></p>
    </div>

</div>

<!-- ===== CHART.JS SCRIPTS ===== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
    const chartColor = {
        primary: '#696cff',
        success: '#71dd5a',
        danger: '#ff3e1d',
        warning: '#ffb64d',
        info: '#03c3ec',
        light: '#f0f0f0',
        dark: '#233446'
    };

    // Update timestamp
    document.getElementById('lastUpdate').textContent = new Date().toLocaleString();

    // ===== Daily Revenue Chart =====
    const dailyRevenueCtx = document.getElementById('dailyRevenueChart').getContext('2d');
    new Chart(dailyRevenueCtx, {
        type: 'line',
        data: {
            labels: {{ daily_labels|safe }},
            datasets: [{
                label: 'Revenue (‚Çπ)',
                data: {{ daily_rev_series|safe }},
                borderColor: chartColor.primary,
                backgroundColor: 'rgba(105, 108, 255, 0.05)',
                borderWidth: 3,
                tension: 0.4,
                fill: true,
                pointRadius: 5,
                pointBackgroundColor: chartColor.primary,
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointHoverRadius: 7
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#999' }
                },
                x: {
                    ticks: { color: '#999' }
                }
            }
        }
    });

    // ===== Daily Orders Chart =====
    const dailyOrdersCtx = document.getElementById('dailyOrdersChart').getContext('2d');
    new Chart(dailyOrdersCtx, {
        type: 'bar',
        data: {
            labels: {{ daily_labels|safe }},
            datasets: [{
                label: 'Orders',
                data: {{ daily_ord_series|safe }},
                backgroundColor: chartColor.success,
                borderRadius: 5,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#999' }
                },
                x: {
                    ticks: { color: '#999' }
                }
            }
        }
    });

    // ===== 6 Months Chart =====
    const sixMonthsCtx = document.getElementById('sixMonthsChart').getContext('2d');
    new Chart(sixMonthsCtx, {
        type: 'line',
        data: {
            labels: {{ six_months_labels|safe }},
            datasets: [
                {
                    label: 'Revenue (‚Çπ)',
                    data: {{ six_months_rev|safe }},
                    borderColor: chartColor.primary,
                    backgroundColor: 'rgba(105, 108, 255, 0.05)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    yAxisID: 'y',
                    pointRadius: 4,
                    pointBackgroundColor: chartColor.primary
                },
                {
                    label: 'Orders',
                    data: {{ six_months_ord|safe }},
                    borderColor: chartColor.success,
                    backgroundColor: 'rgba(113, 221, 90, 0.05)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    yAxisID: 'y1',
                    pointRadius: 4,
                    pointBackgroundColor: chartColor.success
                },
                {
                    label: 'Profit (‚Çπ)',
                    data: {{ six_months_profit|safe }},
                    borderColor: chartColor.warning,
                    borderWidth: 2,
                    tension: 0.4,
                    yAxisID: 'y',
                    pointRadius: 3,
                    pointBackgroundColor: chartColor.warning,
                    borderDash: [5, 5]
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: {
                    display: true,
                    labels: { usePointStyle: true, color: '#666' }
                }
            },
            scales: {
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    ticks: { color: '#999' },
                    title: { display: true, text: 'Revenue & Profit (‚Çπ)' }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    ticks: { color: '#999' },
                    title: { display: true, text: 'Orders (Count)' },
                    grid: { drawOnChartArea: false }
                },
                x: {
                    ticks: { color: '#999' }
                }
            }
        }
    });
</script>
{% endblock %}
