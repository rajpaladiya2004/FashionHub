{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}Home - VibeMall{% endblock %}

{% block content %}

<!-- Slider Area -->
{% if sliders %}
<section class="slider__area">
    <div class="slider__active swiper-container">
        <div class="swiper-wrapper">
            {% for slider in sliders %}
            <div class="slider__item swiper-slide">
                <div class="slider__bg" style="background-image: url('{{ slider.image.url }}');"></div>
                <div class="container">
                    <div class="row">
                        <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-8">
                            <div class="slider__content">
                                <span class="slider__subtitle">{{ slider.subtitle }}</span>
                                <h2 class="slider__title">{{ slider.title }}</h2>
                                <p>{{ slider.description }}</p>
                                <div class="slider__btn">
                                    <a href="{{ slider.button_link }}" class="tp-btn">{{ slider.button_text }}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="slider__nav">
            <button class="slider-button-prev"><i class="fal fa-angle-left"></i></button>
            <button class="slider-button-next"><i class="fal fa-angle-right"></i></button>
        </div>
    </div>
</section>
{% endif %}

<!-- Features Area -->
{% if features %}
<section class="features__area pt-50 pb-20">
    <div class="container">
        <div class="row">
            {% for feature in features %}
            <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                <div class="features__item text-center mb-30">
                    <div class="features__icon">
                        <i class="{{ feature.icon }}"></i>
                    </div>
                    <div class="features__content">
                        <h3 class="features__title">{{ feature.title }}</h3>
                        <p>{{ feature.description }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Categories Area -->
{% if categories %}
<section class="categories__area pt-30 pb-30">
    <div class="container">
        <div class="row">
            <div class="col-xl-12">
                <div class="section__title-wrapper text-center mb-40">
                    <h2 class="section__title">Shop by Category</h2>
                </div>
            </div>
        </div>
        <div class="row">
            {% for category in categories %}
            <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6">
                <div class="categories__item text-center mb-30">
                    <div class="categories__thumb">
                        {% if category.icon_image %}
                        <img src="{{ category.icon_image.url }}" alt="{{ category.get_category_display }}">
                        {% else %}
                        <i class="{{ category.icon_class }}"></i>
                        {% endif %}
                    </div>
                    <div class="categories__content">
                        <h3 class="categories__title">
                            <a href="{% url 'shop' %}?category={{ category.category }}">{{ category.get_category_display }}</a>
                        </h3>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Banners Area -->
{% if banners %}
<section class="banner__area pt-30 pb-30">
    <div class="container">
        <div class="row">
            {% for banner in banners %}
            <div class="col-xl-{{ banner.width|default:'4' }} col-lg-{{ banner.width|default:'4' }} col-md-6">
                <div class="banner__item mb-30">
                    <div class="banner__thumb">
                        <a href="{{ banner.link }}">
                            <img src="{{ banner.image.url }}" alt="{{ banner.title }}">
                        </a>
                    </div>
                    <div class="banner__content">
                        {% if banner.badge_text %}
                        <span class="banner__badge">{{ banner.badge_text }}</span>
                        {% endif %}
                        <h3 class="banner__title">
                            <a href="{{ banner.link }}">{{ banner.title }}</a>
                        </h3>
                        {% if banner.subtitle %}
                        <p>{{ banner.subtitle }}</p>
                        {% endif %}
                        {% if banner.button_text %}
                        <a href="{{ banner.link }}" class="tp-btn-border">{{ banner.button_text }}</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Top Deals Products -->
{% if top_deals %}
<section class="product__area pt-50 pb-30">
    <div class="container">
        <div class="row">
            <div class="col-xl-12">
                <div class="section__title-wrapper text-center mb-40">
                    <h2 class="section__title">{{ category1_title|default:"Top Deals" }}</h2>
                </div>
            </div>
        </div>
        <div class="row">
            {% for product in top_deals %}
            <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6">
                <div class="product__item mb-30">
                    <div class="product__thumb">
                        <a href="{% url 'product_detail' product.slug %}">
                            <img src="{{ product.image.url }}" alt="{{ product.name }}">
                        </a>
                        {% if product.discount > 0 %}
                        <div class="product__badge">-{{ product.discount }}%</div>
                        {% endif %}
                        <div class="product__action">
                            <button class="wishlist-btn-card" onclick="toggleWishlistCard({{ product.id }}, this)">
                                <i class="fal fa-heart"></i>
                            </button>
                        </div>
                    </div>
                    <div class="product__content">
                        <h3 class="product__title">
                            <a href="{% url 'product_detail' product.slug %}">{{ product.name }}</a>
                        </h3>
                        <div class="product__price">
                            <span class="new-price">₹{{ product.price }}</span>
                            {% if product.discount > 0 %}
                            <span class="old-price">₹{{ product.original_price }}</span>
                            {% endif %}
                        </div>
                        <div class="product__rating">
                            {% with stats=product_stats|get_item:product.id %}
                            {% if stats %}
                            <div class="rating">
                                {% for i in "12345" %}
                                <i class="fa{% if forloop.counter <= stats.avg_rating %}s{% else %}r{% endif %} fa-star"></i>
                                {% endfor %}
                                <span>({{ stats.review_count }})</span>
                            </div>
                            {% endif %}
                            {% endwith %}
                        </div>
                        <button class="buy-now-btn-card" onclick="buyNowCard({{ product.id }})">Buy Now</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Top Selling Products -->
{% if top_selling %}
<section class="product__area pt-30 pb-30 grey-bg">
    <div class="container">
        <div class="row">
            <div class="col-xl-12">
                <div class="section__title-wrapper text-center mb-40">
                    <h2 class="section__title">{{ category2_title|default:"Top Selling" }}</h2>
                </div>
            </div>
        </div>
        <div class="row">
            {% for product in top_selling %}
            <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6">
                <div class="product__item mb-30">
                    <div class="product__thumb">
                        <a href="{% url 'product_detail' product.slug %}">
                            <img src="{{ product.image.url }}" alt="{{ product.name }}">
                        </a>
                        {% if product.discount > 0 %}
                        <div class="product__badge">-{{ product.discount }}%</div>
                        {% endif %}
                        <div class="product__action">
                            <button class="wishlist-btn-card" onclick="toggleWishlistCard({{ product.id }}, this)">
                                <i class="fal fa-heart"></i>
                            </button>
                        </div>
                    </div>
                    <div class="product__content">
                        <h3 class="product__title">
                            <a href="{% url 'product_detail' product.slug %}">{{ product.name }}</a>
                        </h3>
                        <div class="product__price">
                            <span class="new-price">₹{{ product.price }}</span>
                            {% if product.discount > 0 %}
                            <span class="old-price">₹{{ product.original_price }}</span>
                            {% endif %}
                        </div>
                        <div class="product__rating">
                            {% with stats=product_stats|get_item:product.id %}
                            {% if stats %}
                            <div class="rating">
                                {% for i in "12345" %}
                                <i class="fa{% if forloop.counter <= stats.avg_rating %}s{% else %}r{% endif %} fa-star"></i>
                                {% endfor %}
                                <span>({{ stats.review_count }})</span>
                            </div>
                            {% endif %}
                            {% endwith %}
                        </div>
                        <button class="buy-now-btn-card" onclick="buyNowCard({{ product.id }})">Buy Now</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Deal Countdown -->
{% if countdown %}
<section class="deal__area pt-50 pb-50">
    <div class="container">
        <div class="row">
            <div class="col-xl-12">
                <div class="deal__wrapper text-center">
                    <h2 class="deal__title">{{ countdown.title }}</h2>
                    <p>{{ countdown.description }}</p>
                    <div class="deal__countdown" data-countdown="{{ countdown.end_date|date:'Y/m/d H:i:s' }}"></div>
                    <a href="{% url 'shop' %}" class="tp-btn">Shop Now</a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Top Featured Products -->
{% if top_featured %}
<section class="product__area pt-50 pb-30">
    <div class="container">
        <div class="row">
            <div class="col-xl-12">
                <div class="section__title-wrapper text-center mb-40">
                    <h2 class="section__title">{{ category3_title|default:"Featured Products" }}</h2>
                </div>
            </div>
        </div>
        <div class="row">
            {% for product in top_featured %}
            <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6">
                <div class="product__item mb-30">
                    <div class="product__thumb">
                        <a href="{% url 'product_detail' product.slug %}">
                            <img src="{{ product.image.url }}" alt="{{ product.name }}">
                        </a>
                        {% if product.discount > 0 %}
                        <div class="product__badge">-{{ product.discount }}%</div>
                        {% endif %}
                        <div class="product__action">
                            <button class="wishlist-btn-card" onclick="toggleWishlistCard({{ product.id }}, this)">
                                <i class="fal fa-heart"></i>
                            </button>
                        </div>
                    </div>
                    <div class="product__content">
                        <h3 class="product__title">
                            <a href="{% url 'product_detail' product.slug %}">{{ product.name }}</a>
                        </h3>
                        <div class="product__price">
                            <span class="new-price">₹{{ product.price }}</span>
                            {% if product.discount > 0 %}
                            <span class="old-price">₹{{ product.original_price }}</span>
                            {% endif %}
                        </div>
                        <div class="product__rating">
                            {% with stats=product_stats|get_item:product.id %}
                            {% if stats %}
                            <div class="rating">
                                {% for i in "12345" %}
                                <i class="fa{% if forloop.counter <= stats.avg_rating %}s{% else %}r{% endif %} fa-star"></i>
                                {% endfor %}
                                <span>({{ stats.review_count }})</span>
                            </div>
                            {% endif %}
                            {% endwith %}
                        </div>
                        <button class="buy-now-btn-card" onclick="buyNowCard({{ product.id }})">Buy Now</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Recommended Products -->
{% if recommended %}
<section class="product__area pt-30 pb-50 grey-bg">
    <div class="container">
        <div class="row">
            <div class="col-xl-12">
                <div class="section__title-wrapper text-center mb-40">
                    <h2 class="section__title">{{ category4_title|default:"Recommended for You" }}</h2>
                </div>
            </div>
        </div>
        <div class="row">
            {% for product in recommended %}
            <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6">
                <div class="product__item mb-30">
                    <div class="product__thumb">
                        <a href="{% url 'product_detail' product.slug %}">
                            <img src="{{ product.image.url }}" alt="{{ product.name }}">
                        </a>
                        {% if product.discount > 0 %}
                        <div class="product__badge">-{{ product.discount }}%</div>
                        {% endif %}
                        <div class="product__action">
                            <button class="wishlist-btn-card" onclick="toggleWishlistCard({{ product.id }}, this)">
                                <i class="fal fa-heart"></i>
                            </button>
                        </div>
                    </div>
                    <div class="product__content">
                        <h3 class="product__title">
                            <a href="{% url 'product_detail' product.slug %}">{{ product.name }}</a>
                        </h3>
                        <div class="product__price">
                            <span class="new-price">₹{{ product.price }}</span>
                            {% if product.discount > 0 %}
                            <span class="old-price">₹{{ product.original_price }}</span>
                            {% endif %}
                        </div>
                        <div class="product__rating">
                            {% with stats=product_stats|get_item:product.id %}
                            {% if stats %}
                            <div class="rating">
                                {% for i in "12345" %}
                                <i class="fa{% if forloop.counter <= stats.avg_rating %}s{% else %}r{% endif %} fa-star"></i>
                                {% endfor %}
                                <span>({{ stats.review_count }})</span>
                            </div>
                            {% endif %}
                            {% endwith %}
                        </div>
                        <button class="buy-now-btn-card" onclick="buyNowCard({{ product.id }})">Buy Now</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

{% endblock %}
