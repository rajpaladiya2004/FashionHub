
# Add this to the end of views.py

@login_required(login_url='login')
def add_product(request):
    # Check if user is admin (username = 'admin')
    if request.user.username != 'admin':
        messages.error(request, 'Access denied. Only admin can add products.')
        return redirect('index')
    
    if request.method == 'POST':
        try:
            # Get form data
            name = request.POST.get('name')
            price = request.POST.get('price')
            old_price = request.POST.get('old_price')
            stock = request.POST.get('stock')
            category = request.POST.get('category')
            rating = request.POST.get('rating', 0)
            review_count = request.POST.get('review_count', 0)
            is_active = request.POST.get('is_active') == 'on'
            is_top_deal = request.POST.get('is_top_deal') == 'on'
            image = request.FILES.get('image')
            
            # Create product
            product = Product.objects.create(
                name=name,
                price=price,
                old_price=old_price if old_price else None,
                stock=stock,
                category=category if category else None,
                rating=rating,
                review_count=review_count,
                is_active=is_active,
                is_top_deal=is_top_deal,
                image=image
            )
            
            messages.success(request, f'Product "{product.name}" added successfully!')
            return redirect('add_product')
            
        except Exception as e:
            messages.error(request, f'Error adding product: {str(e)}')
    
    # Get all products for display
    products = Product.objects.all().order_by('-id')[:10]
    
    return render(request, 'add_product.html', {'products': products})
